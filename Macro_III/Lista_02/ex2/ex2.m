F = @(x, y) 4 ./ ((x-1).^2 + 4.*y.^2 + 1);
f = @(x, y) [-4 * 2.*(x-1) / ((x-1).^2 + 4.*y.^2 + 1).^2,
             -4 * 8.*y / ((x-1).^2 + 4.*y.^2 + 1).^2];
J = @(x, y) [32.*(x-1).^2/((x-1).^2 + 4.*y.^2 + 1).^3 - 8/((x-1).^2 + 4.*y.^2 + 1).^2, 128.*(x-1).*y/((x-1).^2 + 4.*y.^2 + 1).^3;
    128.*(x-1).*y/((x-1).^2 + 4.*y.^2 + 1).^3, 512.*y.^2/((x-1).^2 + 4.*y.^2 + 1).^3 - 32/((x-1).^2 + 4.*y.^2 + 1).^2];

% Graf
u = linspace(-10, 10, 100);
v = linspace(-10, 10, 100);
[U, V] = meshgrid(u,v);
surf(F(U,V), U, V);

% Newton-Rhapson
x(1) = 0.7;
y(1) = 0.2;
k = 1;
kmax = 1000;
err = 1;

while err > 10^-5 && k < kmax
    A = J(x(k), y(k));
    s = linsolve(A, -f(x(k), y(k)));
    x(k+1) = s(1) + x(k);
    y(k+1) = s(2) + y(k);
    z = [x(k) y(k)]';
    zprime = [x(k+1) y(k+1)]';
    err = norm(z-zprime);
    k = k + 1;
end





